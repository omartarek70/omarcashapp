<div class="admin-container">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="title">ููุญุฉ ุงูุชุญูู - {{ currentUser?.name }}</div>
    <button (click)="logout()" class="logout-btn">ุฎุฑูุฌ</button>
  </div>

  <div class="admin-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <nav class="nav-menu">
        <button 
          (click)="navigateTo('dashboard')"
          [class.active]="currentPage === 'dashboard'"
          class="nav-item">
          ๐ ููุญุฉ ุงูุชุญูู
        </button>
        <button 
          (click)="navigateTo('invoices')"
          [class.active]="currentPage === 'invoices'"
          class="nav-item">
          ๐งพ ุงููุงุชูุฑุงุช
        </button>
        <button 
          (click)="navigateTo('products')"
          [class.active]="currentPage === 'products'"
          class="nav-item">
          ๐ฆ ุงูููุชุฌุงุช
        </button>
        <button 
          (click)="navigateTo('reports')"
          [class.active]="currentPage === 'reports'"
          class="nav-item">
          ๐ ุงูุชูุงุฑูุฑ
        </button>
        <button 
          (click)="navigateTo('alerts')"
          [class.active]="currentPage === 'alerts'"
          class="nav-item alerts-nav">
          ๐ ุงูุชูุจููุงุช
          <span *ngIf="upcomingInstallments.length + lowStockProducts.length > 0" class="alert-badge">{{ upcomingInstallments.length + lowStockProducts.length }}</span>
        </button>
        <button 
          (click)="navigateTo('clients')"
          [class.active]="currentPage === 'clients'"
          class="nav-item">
          ๐ฅ ุงูุนููุงุก
        </button>
        <button 
          (click)="navigateTo('returns')"
          [class.active]="currentPage === 'returns'"
          class="nav-item">
          ๐ ุงููุฑุชุฌุนุงุช
        </button>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Page -->
      <div *ngIf="currentPage === 'dashboard'" class="page">
        <h1>ููุญุฉ ุงูุชุญูู</h1>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">๐ฐ</div>
            <div class="stat-info">
              <div class="stat-label">ูุจูุนุงุช ุงูููู</div>
              <div class="stat-value">{{ todaySales }} ุฌููู</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">๐</div>
            <div class="stat-info">
              <div class="stat-label">ุนุฏุฏ ุงููุงุชูุฑุงุช</div>
              <div class="stat-value">{{ todayInvoices }}</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">โ๏ธ</div>
            <div class="stat-info">
              <div class="stat-label">ููุชุฌุงุช ูุงูุตุฉ ุงููุฎุฒูู</div>
              <div class="stat-value">{{ lowStockCount }}</div>
            </div>
          </div>
        </div>
        
        <!-- Daily Report -->
        <div class="daily-report" style="margin-top:24px;">
          <h2>๐ ุชูุฑูุฑ ุงูููู</h2>
          
          <!-- Daily Summary Stats -->
          <div class="daily-stats-grid">
            <div class="daily-stat">
              <div class="stat-number">{{ getDailyReport().invoices.length }}</div>
              <div class="stat-label">ุงูููุงุชูุฑ</div>
            </div>
            <div class="daily-stat highlight-green">
              <div class="stat-number">{{ getDailyReport().totalSales }}</div>
              <div class="stat-label">ุฌููู ูุจูุนุงุช</div>
            </div>
            <div class="daily-stat highlight-red">
              <div class="stat-number">{{ getDailyReport().totalRefunds }}</div>
              <div class="stat-label">ุฌููู ูุฑุชุฌุนุงุช</div>
            </div>
            <div class="daily-stat">
              <div class="stat-number">{{ getDailyReport().totalSales - getDailyReport().totalRefunds }}</div>
              <div class="stat-label">ุฌููู ุตุงูู</div>
            </div>
          </div>

          <!-- Invoices Table -->
          <div *ngIf="getDailyReport().invoices.length === 0" class="empty-message">
            โจ ูุง ุชูุฌุฏ ูุนุงููุงุช ุงูููู
          </div>

          <!-- Start New Day button -->
          <div style="margin-top:12px;">
            <button (click)="confirmStartNewDay()" class="action-btn">๐ ุจุฏุก ููู ุฌุฏูุฏ (ุฃุฑุดูุฉ ุงูููู ูุตูุฑ ุงูููููุฉ)</button>
          </div>
          
          <div *ngIf="getDailyReport().invoices.length > 0" class="invoices-table-wrapper">
            <table class="daily-invoices-table">
              <thead>
                <tr>
                  <th>ุฑูู ุงููุงุชูุฑุฉ</th>
                  <th>ุงูุนููู</th>
                  <th>ุงูููุช</th>
                  <th>ุนุฏุฏ ุงูููุชุฌุงุช</th>
                  <th>ุงูุฅุฌูุงูู ุงูุฌุฒุฆู</th>
                  <th>ุงูุฎุตู</th>
                  <th>ุงูุฅุฌูุงูู</th>
                  <th>ุงูุฏูุน</th>
                  </tr>
              </thead>
              <tbody>
                <tr *ngFor="let inv of getDailyReport().invoices" class="invoice-row">
                  <td class="invoice-number">#{{ inv.invoice_number }}</td>
                  <td class="customer-name">{{ inv.customer_name }}{{ inv.customer_phone ? ' - ' + inv.customer_phone : '' }}</td>
                  <td class="time">{{ inv['date_time_display'] || inv.date_time }}</td>
                  <td class="quantity">{{ inv.items.length }}</td>
                  <td class="subtotal">{{ inv.subtotal }} ุฌููู</td>
                  <td class="discount" [class.no-discount]="inv.discount_percent === 0">
                    <span *ngIf="inv.discount_percent > 0" class="discount-badge">{{ inv.discount_percent }}% (-{{ inv.discount_amount }})</span>
                    <span *ngIf="inv.discount_percent === 0" class="no-discount-text">-</span>
                  </td>
                  <td class="total-amount">{{ inv.total }} ุฌููู</td>
                  <td class="payment-method" [class.installment]="inv.payment_method === 'ูุณุท'">
                    <span class="method-badge">{{ inv.payment_method }}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Expandable Invoice Details -->
          <div *ngIf="getDailyReport().invoices.length > 0" class="invoices-details-section">
            <h3>๐ ุชูุงุตูู ุงูููุงุชูุฑ</h3>
            <div *ngFor="let inv of getDailyReport().invoices; let i = index" class="invoice-detail-card">
              <div class="detail-header" (click)="toggleInvoiceDetail(i)">
                <div class="header-left">
                  <span class="invoice-num">ูุงุชูุฑุฉ #{{ inv.invoice_number }}</span>
                  <span class="customer-info">{{ inv.customer_name }}{{ inv.customer_phone ? ' - ' + inv.customer_phone : '' }} - {{ inv['date_time_display'] || inv.date_time }}</span>
                </div>
                <div class="header-right">
                  <span class="detail-total">{{ inv.total }} ุฌููู</span>
                  <span class="toggle-icon" [class.open]="expandedInvoices[i]">โผ</span>
                </div>
              </div>
              
              <div *ngIf="expandedInvoices[i]" class="detail-content">
                <table class="items-details-table">
                  <tr>
                    <th>ุงูููุชุฌ</th>
                    <th>ุงููููุฉ</th>
                    <th>ุงูุณุนุฑ</th>
                    <th>ุงูุฅุฌูุงูู</th>
                  </tr>
                  <tr *ngFor="let item of inv.items">
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.unit_price }} ุฌููู</td>
                    <td>{{ item.line_total }} ุฌููู</td>
                  </tr>
                </table>
                
                <div class="invoice-summary">
                  <div class="summary-line">
                    <span>ุงูุฅุฌูุงูู ุงูุฌุฒุฆู:</span>
                    <span class="amount">{{ inv.subtotal }} ุฌููู</span>
                  </div>
                  <div *ngIf="inv.discount_percent > 0" class="summary-line discount-line">
                    <span>ุฎุตู ({{ inv.discount_percent }}%):</span>
                    <span class="amount">-{{ inv.discount_amount }} ุฌููู</span>
                  </div>
                  <div class="summary-line total-line">
                    <span>ุงูุฅุฌูุงูู ุงูููุงุฆู:</span>
                    <span class="amount">{{ inv.total }} ุฌููู</span>
                  </div>
                  <div class="summary-line">
                    <span>ุทุฑููุฉ ุงูุฏูุน:</span>
                    <span class="amount method">{{ inv.payment_method }}</span>
                  </div>
                  
                  <!-- Installments if applicable -->
                  <div *ngIf="inv.payment_method === 'ูุณุท' && inv.installments" class="installments-details">
                    <div class="installments-title">ุงูุฃูุณุงุท:</div>
                    <div *ngFor="let inst of inv.installments" class="installment-detail-line">
                      <span>ุงููุณุท {{ inst.installment_number }}:</span>
                      <span class="inst-amount">{{ inst.amount }} ุฌููู</span>
                      <span class="inst-date">ุงุณุชุญูุงู: {{ inst.due_date }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Daily Totals Summary -->
          <div *ngIf="getDailyReport().invoices.length > 0" class="daily-totals-summary">
            <div class="summary-title">๐ ููุฎุต ุงูููู ุงูุดุงูู</div>
            <div class="summary-grid">
              <div class="summary-item green">
                <span class="label">ุฅุฌูุงูู ุงููุจูุนุงุช:</span>
                <span class="value">{{ getDailyReport().totalSales }} ุฌููู</span>
              </div>
              <div class="summary-item red">
                <span class="label">ุฅุฌูุงูู ุงููุฑุชุฌุนุงุช:</span>
                <span class="value">{{ getDailyReport().totalRefunds }} ุฌููู</span>
              </div>
              <div class="summary-item blue">
                <span class="label">ุงูุตุงูู:</span>
                <span class="value">{{ getDailyReport().totalSales - getDailyReport().totalRefunds }} ุฌููู</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Monthly report removed from dashboard. Use 'ุงูุชูุงุฑูุฑ' page for per-day monthly breakdown. -->

        <div class="dashboard-section">
          <h2>ุงูููุชุฌุงุช ูุงูุตุฉ ุงููุฎุฒูู</h2>
          <div *ngIf="getLowStockProducts().length === 0" class="empty-message">
            ุฌููุน ุงูููุชุฌุงุช ูุชููุฑุฉ
          </div>
          <table *ngIf="getLowStockProducts().length > 0" class="products-table">
            <tr>
              <th>ุงุณู ุงูููุชุฌ</th>
                <th>HGN</th>
                <th>ุงููุชุงุญ</th>
                <th>ุงูุญุฏ ุงูุฃุฏูู</th>
            </tr>
            <tr *ngFor="let product of getLowStockProducts()" class="low-stock-row">
              <td>{{ product.name }}</td>
                <td>{{ product.hgn }}</td>
                <td class="stock-qty">{{ product.stock_quantity }}</td>
                <td>-</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Invoices Page -->
      <div *ngIf="currentPage === 'invoices'" class="page">
        <h1>ุณุฌู ุงููุงุชูุฑุงุช</h1>
        
        <div class="page-actions">
          <button (click)="exportToCSV()" class="action-btn export-btn">๐ฅ ุชุตุฏูุฑ CSV</button>
          <button (click)="printReport()" class="action-btn print-btn">๐จ๏ธ ุทุจุงุนุฉ</button>
        </div>

        <div *ngIf="invoices.length === 0" class="empty-message">
          ูุง ุชูุฌุฏ ูุงุชูุฑุงุช ุญุงููุงู
        </div>

        <table *ngIf="invoices.length > 0" class="invoices-table">
          <tr>
            <th>ุฑูู ุงููุงุชูุฑุฉ</th>
            <th>ุงูุชุงุฑูุฎ</th>
            <th>ุงูุนููู</th>
            <th>ุงููุงุดูุฑ</th>
            <th>ุงูุฅุฌูุงูู</th>
            <th>ุทุฑููุฉ ุงูุฏูุน</th>
          </tr>
          <tr *ngFor="let invoice of invoices">
            <td>{{ invoice.invoice_number }}</td>
            <td>{{ invoice.date_time }}</td>
            <td>{{ invoice.customer_name }}</td>
            <td>{{ invoice.cashier_name }}</td>
            <td>{{ invoice.total }}</td>
            <td>{{ invoice.payment_method }}</td>
          </tr>
        </table>
        <div *ngIf="showEditProductForm" class="form-container" style="margin-top:12px; background:#fff; padding:12px;">
          <h3>ุชุนุฏูู ุงูููุชุฌ</h3>
          <div class="form-group">
            <label>ุงูุงุณู</label>
            <input [(ngModel)]="editingProduct!.name" name="edit_name" placeholder="ุงุณู ุงูููุชุฌ">
          </div>
          <div class="form-group">
            <label>ููุฏ ุงูููุชุฌ </label>
            <input [(ngModel)]="editingProduct!.hgn" name="edit_hgn" placeholder="HGN">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงููุตูุน</label>
            <input type="number" [(ngModel)]="editingProduct!.cost_price" name="edit_cost" placeholder="ุณุนุฑ ุงููุตูุน">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงูุฌููุฉ</label>
            <input type="number" [(ngModel)]="editingProduct!.wholesale_price" name="edit_wholesale" placeholder="ุณุนุฑ ุงูุฌููุฉ">
          </div>
          <div class="form-group">
            <label>ุงูุญุฏ ุงูุฃุฏูู ููุจูุน</label>
            <input type="number" [(ngModel)]="editingProduct!.min_stock" name="edit_min_stock" placeholder="ุงูุญุฏ ุงูุฃุฏูู ููุจูุน">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงูุจูุน</label>
            <input type="number" [(ngModel)]="editingProduct!.sale_price" name="edit_sale" placeholder="ุณุนุฑ ุงูุจูุน">
          </div>
          <div class="form-group">
            <label>ุงููููุฉ</label>
            <input type="number" [(ngModel)]="editingProduct!.stock_quantity" name="edit_stock" placeholder="ุงููููุฉ">
          </div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button (click)="saveEditedProduct()" class="save-btn">๐พ ุญูุธ ุงูุชุนุฏููุงุช</button>
            <button (click)="cancelEdit()" class="reset-btn">ุฅูุบุงุก</button>
          </div>
        </div>
      </div>

      <!-- Returns Page -->
      <div *ngIf="currentPage === 'returns'" class="page">
        <h1>ุณุฌู ุงููุฑุชุฌุนุงุช</h1>

        <div class="form-group">
          <label>ุจุญุซ ูู ุงููุฑุชุฌุนุงุช (ุฑูู ุงููุงุชูุฑุฉ ุฃู ุงุณู ุงูุนููู)</label>
          <input [(ngModel)]="returnsSearchQuery" name="returnsSearch" placeholder="ุจุญุซ...">
        </div>

        <div *ngIf="returns && returns.length === 0" class="empty-message">ูุง ุชูุฌุฏ ูุฑุชุฌุนุงุช ูุณุฌูุฉ</div>
        <div *ngIf="returns && returns.length > 0">
          <table class="invoices-table">
            <tr>
              <th>ุฑูู ุงููุงุชูุฑุฉ</th>
              <th>ุชุงุฑูุฎ ุงููุฑุชุฌุน</th>
              <th>ุงููุนุงูุฌ</th>
              <th>ุงููุจูุบ ุงููุณุชุฑุฏ</th>
            </tr>
            <tr *ngFor="let r of returns">
              <td>{{ r.invoice_number }}</td>
              <td>{{ r.date_time }}</td>
              <td>{{ r.processed_by }}</td>
              <td>{{ r.refund_amount }}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Clients Page -->
      <div *ngIf="currentPage === 'clients'" class="page">
        <h1>ูุงุฆูุฉ ุงูุนููุงุก</h1>

        <div class="form-group" style="margin-bottom:12px;">
          <h3>ุฅุถุงูุฉ ุนููู ูุฏูู</h3>
          <label>ุงูุงุณู</label>
          <input [(ngModel)]="newClientName" name="newClientName" placeholder="ุงุณู ุงูุนููู">
          <label>ุฑูู ุงููุงุชู</label>
          <input [(ngModel)]="newClientPhone" name="newClientPhone" placeholder="ุฑูู ุงููุงุชู">
          <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงุฎุชูุงุฑู)</label>
          <input [(ngModel)]="newClientEmail" name="newClientEmail" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู">
          <button (click)="addCustomer(newClientName, newClientPhone)" class="add-btn">โ ุฅุถุงูุฉ</button>
        </div>

        <div *ngIf="customers.length === 0" class="empty-message">ูุง ุชูุฌุฏ ุนููุงุก ูุณุฌููู</div>
        <table *ngIf="customers.length > 0" class="invoices-table">
          <tr>
            <th>ุงูุงุณู</th>
            <th>ุงููุงุชู</th>
            <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
            <th>ุงูููุงุท</th>
            <th>ุขุฎุฑ ุดุฑุงุก</th>
            <th></th>
          </tr>
          <tr *ngFor="let c of customers">
            <td>{{ c.name }}</td>
            <td>{{ c.phone }}</td>
            <td>{{ c.email || '-' }}</td>
            <td>{{ c.points || 0 }}</td>
            <td>{{ c.last_purchase_at || c.created_at || '-' }}</td>
            <td>
              <button (click)="monthlySearchQuery = c.name; navigateTo('invoices')" class="details-btn">ุนุฑุถ ุงูููุงุชูุฑ</button>
            </td>
          </tr>
        </table>
      </div>

      <!-- Products Page -->
      <div *ngIf="currentPage === 'products'" class="page">
        <h1>ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h1>

        <button 
          (click)="toggleAddForm()"
          class="action-btn add-btn">
          {{ showAddProductForm ? 'โ๏ธ ุฅูุบุงุก' : 'โ ุฅุถุงูุฉ ููุชุฌ' }}
        </button>

          <div *ngIf="showAddProductForm" class="form-container">
          <h3>ููุชุฌ ุฌุฏูุฏ</h3>
          <div class="form-group">
            <label>ุงูุงุณู</label>
            <input [(ngModel)]="newProduct.name" name="name" placeholder="ุงุณู ุงูููุชุฌ">
          </div>
          <div class="form-group">
            <label>ููุฏ ุงูููุชุฌ</label>
            <input [(ngModel)]="newProduct.hgn" name="hgn" placeholder=" ููุฏ ุงูููุชุฌ">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงููุตูุน </label>
            <input type="number" [(ngModel)]="newProduct.cost_price" name="cost_price" placeholder="ุณุนุฑ ุงููุตูุน">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงูุฌููู </label>
            <input type="number" [(ngModel)]="newProduct.wholesale_price" name="wholesale_price" placeholder="ุณุนุฑ ุงูุฌููู">
          </div>
          <div class="form-group">
            <label>ุงูุญุฏ ุงูุฃุฏูู ููุจูุน</label>
            <input type="number" [(ngModel)]="newProduct.min_stock" name="min_stock" placeholder="ุงูุญุฏ ุงูุฃุฏูู ูููุฎุฒูู">
          </div>
          <!-- ุถุฑูุจุฉ ุฃูุฒููุช -->
          <div class="form-group">
            <label>ุงููููุฉ</label>
              <input type="number" [(ngModel)]="newProduct.stock_quantity" name="stock" placeholder="ุงููููุฉ">
          </div>
          <div class="form-group">
            <label>ุณุนุฑ ุงูุจูุน </label>
              <input type="number" [(ngModel)]="newProduct.sale_price" name="sale_price" placeholder="ุณุนุฑ ุงูุจูุน">
          </div>
          <button (click)="addProduct()" class="save-btn">๐พ {{ editingProductId ? 'ุญูุธ ุงูุชุนุฏููุงุช' : 'ุญูุธ' }}</button>
        </div>

        <table class="products-table">
          <tr>
            <th>ุงูุงุณู</th>
            <th>SKU</th>
            <th>ุณุนุฑ ุงููุตูุน</th>
            <th>ุณุนุฑ ุงูุฌููู</th>
            <th>ุงููุชุงุญ</th>
            <th>ุงูุญุฏ ุงูุฃุฏูู</th>
            <th>ุณุนุฑ ุงูุจูุน</th>
            <th></th>
          </tr>
          <tr *ngFor="let product of products">
            <td>{{ product.name }}</td>
            <td>{{ product.hgn }}</td>
            <td>{{ product.cost_price }}</td>
            <td>{{ product.wholesale_price }}</td>
            <td>{{ product.stock_quantity }}</td>
            <td>{{ product.min_stock || '-' }}</td>
            <td>{{ product.sale_price }}</td>
            <td>
              <button (click)="updateProduct(product)" class="edit-btn">โ๏ธ ุชุนุฏูู</button>
              <button (click)="deleteProduct(product.id)" class="delete-btn">๐๏ธ</button>
            </td>
          </tr>
        </table>
      </div>

      <!-- Reports Page -->
      <div *ngIf="currentPage === 'reports'" class="page">
        <h1>ุงูุชูุงุฑูุฑ</h1>
        
        <div class="report-actions">
          <button (click)="exportToCSV()" class="action-btn export-btn">๐ ุชูุฑูุฑ ุดุงูู</button>
          <button (click)="printReport()" class="action-btn print-btn">๐จ๏ธ ุทุจุงุนุฉ ุงูุชูุฑูุฑ</button>
          <button (click)="monthlyInvoicesOpen = !monthlyInvoicesOpen" class="action-btn export-btn">๐ ููุงุชูุฑ ุงูุดูุฑ</button>
        </div>

        <div class="report-summary">
          <h2>ููุฎุต ุงููุจูุนุงุช</h2>
          <div class="summary-grid">
            <div class="summary-item">
              <span class="summary-label">ุฅุฌูุงูู ุงููุจูุนุงุช:</span>
              <span class="summary-value">{{ getTotalSales() }} ุฌููู</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ุนุฏุฏ ุงููุงุชูุฑุงุช:</span>
              <span class="summary-value">{{ invoices.length }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ูุชูุณุท ุงููุงุชูุฑุฉ:</span>
              <span class="summary-value">{{ getAverageInvoice().toFixed(2) }} ุฌููู</span>
            </div>
          </div>
        </div>

        <!-- Monthly breakdown: show sales per day for chosen month -->
        <div class="monthly-breakdown" style="margin-top:20px; background:#fff; padding:12px; border-radius:8px;">
          <h3>ุชูุตูู ุดูุฑู โ ูุจูุนุงุช ูู ููู</h3>
          <div style="display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-bottom:8px;">
            <label>ุงูุณูุฉ</label>
            <input type="number" [(ngModel)]="reportYear" name="reportYear" style="width:110px; margin-left:6px;" />
            <label>ุงูุดูุฑ</label>
            <select [(ngModel)]="reportMonth" name="reportMonth" style="width:100px; margin-left:6px;">
              <option *ngFor="let m of [0,1,2,3,4,5,6,7,8,9,10,11]" [ngValue]="m">{{ m + 1 }}</option>
            </select>
          </div>
          <div *ngIf="getMonthlyBreakdown().dailyReports.length === 0" class="empty-message">ูุง ุชูุฌุฏ ูุนุงููุงุช ูู ูุฐุง ุงูุดูุฑ</div>
          <div *ngFor="let d of getMonthlyBreakdown().dailyReports" style="margin-bottom:8px; padding:8px; background:#fff; border-left:4px solid #667eea;">
            <div style="display:flex; justify-content:space-between; direction:rtl;">
              <div>{{ d.date }}</div>
              <div>ูุจูุนุงุช: {{ d.totalSales }} ุฌููู โ ูุฑุชุฌุนุงุช: {{ d.totalRefunds }} ุฌููู โ ููุงุชูุฑ: {{ d.invoices.length }}</div>
            </div>
          </div>
          <div style="margin-top:10px; font-weight:700;">ุฅุฌูุงูู ุงููุจูุนุงุช ููุดูุฑ: {{ getMonthlyBreakdown().totalSales }} ุฌููู</div>
          <div style="margin-top:6px; font-weight:700; color:#ff5252;">ุฅุฌูุงูู ุงููุฑุชุฌุนุงุช ููุดูุฑ: {{ getMonthlyBreakdown().totalRefunds }} ุฌููู</div>
        </div>

        <div *ngIf="monthlyInvoicesOpen" style="margin-top:20px; background:#fff; padding:12px; border-radius:8px;">
          <h3>ููุงุชูุฑ ูุฐุง ุงูุดูุฑ</h3>
          <div class="form-group">
            <input placeholder="ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ ุฃู ุงุณู ุงูุนููู" [(ngModel)]="monthlySearchQuery" name="monthlySearch">
          </div>
          <div *ngIf="getFilteredMonthlyInvoices().length === 0" class="empty-message">ูุง ุชูุฌุฏ ููุงุชูุฑ ููุฐุง ุงูุดูุฑ</div>
          <div *ngFor="let inv of getFilteredMonthlyInvoices()" style="border-bottom:1px solid #eee; padding:8px 0; direction:rtl;">
            <div style="display:flex; justify-content:space-between;">
              <div>ูุงุชูุฑุฉ #{{ inv.invoice_number }} - {{ inv.customer_name }}</div>
              <div>{{ inv['date_time_display'] || inv.date_time }} โ {{ inv.total }} ุฌููู</div>
            </div>
          </div>
        </div>
        
        <!-- Archived Days (Daily Archives) -->
        <div style="margin-top:20px; background:#fff; padding:12px; border-radius:8px;">
          <h3>ุฃุฑุดูู ุงูุฃูุงู</h3>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
            <label>ุชุตููุฉ ุจุงูููู</label>
            <input type="date" [(ngModel)]="archivedFilterDate" name="archivedFilterDate" />
            <button (click)="loadArchivedDays()" class="action-btn">ุชุญุฏูุซ ุงูุฃุฑุดูู</button>
            <button (click)="archivedFilterDate='';" class="reset-btn">ุฅูุบุงุก ุงูููุชุฑ</button>
          </div>
          <div *ngIf="getFilteredArchivedDays().length === 0" class="empty-message">ูุง ุชูุฌุฏ ุฃูุงู ูุคุฑุดูุฉ</div>
          <div *ngFor="let d of getFilteredArchivedDays()" style="margin-bottom:8px; padding:8px; border-left:4px solid #4caf50; display:flex; justify-content:space-between; align-items:center;">
            <div>
              <div style="font-weight:700">{{ d.date }}</div>
              <div style="color:#666; font-size:13px;">ูุจูุนุงุช: {{ d.totalSales }} โ ูุฑุชุฌุนุงุช: {{ d.totalRefunds }} โ ุนุฏุฏ ุงูููุงุชูุฑ: {{ (d.invoices || []).length }}</div>
            </div>
            <div style="display:flex; gap:8px;">
              <button (click)="viewArchivedDay(d)" class="action-btn">ุนุฑุถ ุงูุชูุงุตูู</button>
              <button (click)="restoreArchivedDay(d)" class="add-btn">ุงุณุชุนุงุฏุฉ ุงูููู</button>
            </div>
          </div>

          <div *ngIf="selectedArchivedDay" style="margin-top:12px; background:#fff; padding:12px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.06);">
            <h4>ุชูุงุตูู ูููู: {{ selectedArchivedDay.date }}</h4>
            <div style="margin-bottom:8px;">ุฅุฌูุงูู ุงููุจูุนุงุช: {{ selectedArchivedDay.totalSales }} โ ุฅุฌูุงูู ุงููุฑุชุฌุนุงุช: {{ selectedArchivedDay.totalRefunds }}</div>
            <div *ngIf="selectedArchivedDay.perCashier && selectedArchivedDay.perCashier.length > 0">
              <h5>ุชูุตูู ุจุงููุงุดูุฑ</h5>
              <div *ngFor="let c of selectedArchivedDay.perCashier" style="padding:6px 0; border-bottom:1px solid #f1f1f1;">
                <div style="font-weight:600">{{ c.cashier_name }} โ ูุจูุนุงุช: {{ c.totalSales }} โ ูุฑุชุฌุนุงุช: {{ c.totalRefunds || 0 }}</div>
                <div style="font-size:13px; color:#444;">ูุงุชูุฑุงุช: {{ c.invoices.length }}</div>
              </div>
            </div>
            <div style="margin-top:10px; display:flex; gap:8px;">
              <button (click)="restoreArchivedDay(selectedArchivedDay)" class="add-btn">ุงุณุชุนุงุฏุฉ ูุฐุง ุงูููู</button>
              <button (click)="clearArchivedSelection()" class="reset-btn">ุฅุบูุงู ุงูุชูุงุตูู</button>
            </div>
          </div>
        </div>

      </div>

      <!-- Alerts Page -->
      <div *ngIf="currentPage === 'alerts'" class="page">
        <h1>ุงูุชูุจููุงุช ูุงูุชุฐููุฑุงุช</h1>

        <!-- Upcoming Installments Section -->
        <div class="alerts-section">
          <div class="section-header">
            <h2>๐ ุงูุฃูุณุงุท ุงููุฑูุจุฉ ูู ุงูุงุณุชุญูุงู</h2>
            <span class="count-badge">{{ upcomingInstallments.length }}</span>
          </div>

          <div *ngIf="upcomingInstallments.length === 0" class="empty-message">
            ูุง ุชูุฌุฏ ุฃูุณุงุท ูุฑูุจุฉ ูู ุงูุงุณุชุญูุงู
          </div>

          <div *ngFor="let alert of upcomingInstallments" class="alert-card installment-alert">
            <div class="alert-header">
              <div class="alert-title">
                <span class="alert-label">ูุงุชูุฑุฉ #{{ alert.invoice_number }}</span>
                <span class="alert-customer">{{ alert.customer_name }}</span>
              </div>
              <div class="alert-days" [class.urgent]="alert.days_remaining <= 2">
                ูุชุจูู: <strong>{{ alert.days_remaining }}</strong> ููู
              </div>
            </div>
            <div class="alert-details">
              <div class="detail-item">
                <span class="label">ุงููุณุท:</span>
                <span class="value">#{{ alert.installment_number }}</span>
              </div>
              <div class="detail-item">
                <span class="label">ุงููุจูุบ:</span>
                <span class="value amount">{{ alert.amount }} ุฌููู</span>
              </div>
              <div class="detail-item">
                <span class="label">ุชุงุฑูุฎ ุงูุงุณุชุญูุงู:</span>
                <span class="value date">{{ alert.due_date }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Low Stock Products Section -->
        <div class="alerts-section">
          <div class="section-header">
            <h2>๐ฆ ุงูููุชุฌุงุช ุงูููุฎูุถุฉ ุงููุฎุฒูู</h2>
            <span class="count-badge">{{ lowStockProducts.length }}</span>
          </div>

          <div *ngIf="lowStockProducts.length === 0" class="empty-message">
            ุฌููุน ุงูููุชุฌุงุช ูุชููุฑุฉ ุจูููุงุช ุฌูุฏุฉ
          </div>

          <div *ngFor="let product of lowStockProducts" class="alert-card stock-alert">
            <div class="alert-header">
              <div class="alert-title">
                <span class="alert-label">{{ product.name }}</span>
                <span class="alert-sku">{{ product.hgn }}</span>
              </div>
              <div class="stock-status" [class.critical]="product.stock_quantity === 0">
                ุงููุชุงุญ: <strong>{{ product.stock_quantity }}</strong>
              </div>
            </div>
            <div class="alert-details">
              <div class="detail-item">
                <span class="label">ุงูุณุนุฑ:</span>
                <span class="value price">{{ product.sale_price }} ุฌููู</span>
              </div>
              <div class="detail-item">
                <span class="label">ุงูุญุงูุฉ:</span>
                <span class="value status" [class.critical]="product.stock_quantity === 0">
                  {{ product.stock_quantity === 0 ? 'โ ุฎุงุฑุฌ ุงููุฎุฒูู' : 'โ๏ธ ูุฑูุจ ูู ุงูุงูุชูุงุก' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
